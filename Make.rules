
define run_and_test
printf "%b" "$(OK_COLOR)$(WAIT_STRING)$(NO_COLOR)$(COM_COLOR)$(2)$(OBJ_COLOR) $(@F)...\r"; \
$(1) 2> $@.log; \
RESULT=$$?; \
if [ $$RESULT -ne 0 ]; then \
	printf "%b" "$(ERROR_COLOR)$(ERROR_STRING)$(ERROR_COLOR)$(COM_COLOR)$(2)$(OBJ_COLOR) $(@F)... $(NO_COLOR)\n"   ; \
elif [ -s $@.log ]; then \
	printf "%b" "$(WARN_COLOR)$(WARN_STRING)$(WARN_COLOR)$(COM_COLOR)$(2)$(OBJ_COLOR) $(@F)... $(NO_COLOR)\n"   ; \
else  \
	printf "%b" "$(OK_COLOR)$(OK_STRING)$(NO_COLOR)$(COM_COLOR)$(2)$(OBJ_COLOR) $(@F)... $(DONE_COLOR)Done!$(NO_COLOR)\n"   ; \
fi; \
cat $@.log; \
rm -f $@.log; \
exit $$RESULT
endef
